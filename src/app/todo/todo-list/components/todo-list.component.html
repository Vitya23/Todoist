<div class="wrapper">
  <div class="table" *ngIf="tasks() as tasks">
    <ng-container *ngIf="categories() as categories">
      <p-table
        #table
        [value]="tasks"
        [resizableColumns]="true"
        [scrollable]="true"
        [paginator]="true"
        [rows]="5"
        [showCurrentPageReport]="true"
        currentPageReportTemplate="Показаны записи с {first} по {last} из {totalRecords}"
        [globalFilterFields]="[
          'description',
          'category',
          'endDate',
          'priority'
        ]"
      >
        <ng-template pTemplate="caption">
          <div class="caption">
            <app-menu></app-menu>
          </div>
        </ng-template>
        <ng-template pTemplate="header" #head>
          <tr>
            <th>Задача</th>
            <th>Категория</th>
            <th class="status__col">Статус</th>
            <th class="menu__col"></th>
          </tr>
          <tr>
            <th class="description__col">
              <!-- <p-columnFilter
                #colFilter
                [field]="field"
                [matchModeOptions]="matchModeOptions"
                (onChange)="this.field = 'a'"
                display="menu"
                [showOperator]="false"
                [showAddButton]="false"
              >
                <ng-template
                  pTemplate="filter"
                  let-value
                  let-filter="filterCallback"
                >
                  {{ colFilter.dt.filter | json }}
                  {{ field }}
                  @if(field === 'description'){
                  <input
                    pInputText
                    #inp
                    type="text"
                    (input)="
                      table.filter(inp.value, 'isPrimeNumber', 'contains')
                    "
                  />
                  {{ inp.value }}
                  } @else{
                  <p-multiSelect
                    [ngModel]="value"
                    [options]="tasks"
                    placeholder="Any"
                    (onChange)="filter($event.value)"
                    optionLabel="name"
                  >
                    <ng-template let-option pTemplate="item">
                      <div class="inline-block vertical-align-middle">
                        <span class="ml-1 mt-1">{{ option.name }}</span>
                      </div>
                    </ng-template>
                  </p-multiSelect>
                  }
                </ng-template>
              </p-columnFilter> -->
              <app-filter [table]="table"></app-filter>
            </th>
            <th class="category__col">
              <p-columnFilter
                field="category"
                matchMode="equals"
                [showMenu]="false"
              >
                <ng-template
                  pTemplate="filter"
                  let-value
                  let-filter="filterCallback"
                >
                  <p-dropdown
                    [(ngModel)]="selectedCategories"
                    [options]="categories"
                    (onChange)="filter($event.value?.id)"
                    placeholder="Категории"
                    [showClear]="true"
                    appendTo="body"
                    optionLabel="title"
                    [filter]="true"
                    filterBy="title"
                  >
                    <ng-template let-option pTemplate="item">
                      <div class="category_filter">
                        <span>{{ option.title }}</span>
                        <p-button
                          [text]="true"
                          size="small"
                          icon="pi pi-times"
                          (onFocus)="
                            generateDeleteComponent(
                              option.id,
                              deleteMods.Category
                            )
                          "
                        ></p-button>
                      </div>
                    </ng-template>
                  </p-dropdown>
                </ng-template>
              </p-columnFilter>
            </th>
            <th class="status__col">
              <p-sortIcon field="status" pSortableColumn="status"></p-sortIcon>
            </th>
            <th colspan="2"></th>
          </tr>
        </ng-template>
        <ng-template pTemplate="body" let-task>
          <tr>
            <td>
              <div class="table__description">
                <p highlightPriority [priority]="task.priority">
                  {{ task.description }}
                </p>
                <small class="date" title="Время окончания задачи">{{
                  task.endDate | date : "d MMMM y"
                }}</small>
              </div>
            </td>
            <td>
              <app-category
                [taskId]="task.id"
                [categoryId]="task.category"
              ></app-category>
            </td>

            <td class="table__status">
              <app-todo-status
                [id]="task.id"
                [status]="task.status"
              ></app-todo-status>
            </td>
            <td>
              <p-button
                [text]="true"
                size="small"
                icon="pi pi-pencil"
                (click)="generateTodoEditComponent(task)"
              ></p-button>
              <p-button
                [text]="true"
                size="small"
                icon="pi pi-times"
                (click)="generateDeleteComponent(task.id, deleteMods.Task)"
              ></p-button>
            </td>
          </tr>
        </ng-template>
      </p-table>

      <ng-container #ChildInsertionPoint></ng-container>
    </ng-container>
  </div>
</div>
