<ng-container #DelCategoryInsertionPoint></ng-container>
@if(!category().title?.length && taskId ){

<p-button
  label="Добавить категорию"
  icon="pi pi-plus"
  [text]="true"
  size="small"
  (click)="active = true"
></p-button>

} @if(category().title ){

<div class="category">
  <div class="category__title">
    <small> {{ category().title }}</small>
  </div>

  <div class="category__menu">
    <p-confirmPopup></p-confirmPopup>
    <p-menu #menu [model]="items" [popup]="true" appendTo="body"></p-menu>
    <p-button
      (click)="menu.toggle($event)"
      icon="pi pi-ellipsis-h "
      [text]="true"
      severity="danger "
      size="small"
    ></p-button>
  </div>
</div>

}

<p-dialog
  [header]="taskId ? 'Изменение категории' : 'Добавление категории'"
  [(visible)]="active"
  [draggable]="false"
  [resizable]="false"
>
  <ng-template pTemplate="content">
    <form [formGroup]="form" (ngSubmit)="onSubmit()">
      @if(!taskId){
      <input
        trimOnBlur
        class="input"
        formControlName="title"
        type="text"
        pInputText
      />

      } @if(categories() && taskId){

      <p-autoComplete
        formControlName="title"
        [dropdown]="true"
        [suggestions]="filteredCategories!"
        (completeMethod)="filterCategory($event)"
        appendTo="body"
      >
        <ng-template let-category pTemplate="item">
          <div class="flex align-items-center gap-2">
            <div>{{ category }}</div>
          </div>
        </ng-template>
      </p-autoComplete>

      }
      <div class="footer">
        <div class="footer__setAll">
          <p-checkbox
            [binary]="true"
            inputId="setAll"
            formControlName="setAll"
          ></p-checkbox>
          <label for="setAll">{{
            taskId
              ? "Изменить категорию для всех задач"
              : "Добавить ко всем задачам без категории"
          }}</label>
        </div>
        <div class="footer__buttons">
          <p-button
            type="submit"
            size="small"
            class="footer_button"
            [label]="taskId ? 'Сохранить' : 'Добавить'"
            severity="danger"
            [plain]="true"
            [disabled]="this.form.invalid"
          ></p-button>
          <p-button
            (click)="active = false"
            size="small"
            label="Отмена"
            [text]="true"
            [plain]="true"
          ></p-button>
        </div>
      </div>
    </form>
  </ng-template>
</p-dialog>
